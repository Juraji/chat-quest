@if (editMode()) {
  <form [formGroup]="formGroup" (submit)="onFormSubmit()">
    <div class="d-flex align-items-center gap-3 mb-3">
      @if (!characterId()) {
        <div>
          <label for="characterIdSelect">Character</label>
          <select class="form-select"
                  id="characterIdSelect"
                  aria-describedby="characterIdSelectHelp"
                  formControlName="characterId">
            <option [ngValue]="null">All</option>
            @for (c of allCharacters(); track c.id) {
              <option [ngValue]="c.id">{{ c.name }}</option>
            }
          </select>
          <div class="form-text" id="characterIdSelectHelp">
            You can set this memory to be for a specific character
            or "All" for a general memory applicable to everyone.
          </div>
        </div>
      }
      <div class="form-check ">
        <input class="form-check-input" type="checkbox" id="alwaysIncludeInput"
               formControlName="alwaysInclude"/>
        <label class="form-check-label" for="alwaysIncludeInput">
          Always include this memory
        </label>
      </div>
    </div>

    <div class="mb-3">
      <label for="contentInput">Content</label>
      <input type="text" class="form-control"
             id="contentInput"
             aria-describedby="contentInputHelp"
             formControlName="content"/>
      <div class="form-text" id="contentInputHelp">
        Memories should be a short and descriptive.
      </div>
    </div>

    <div class="btn-toolbar justify-content-end gap-1">
      <button class="btn btn-sm btn-primary btn-magical"
              [disabled]="formGroup.invalid || formGroup.pristine">
        Save Changes
      </button>
      <button type="button" class="btn btn-sm btn-outline-danger"
              (click)="deleteRequested.emit()">
        Delete Memory
      </button>

      @if (!isNew()) {
        <button type="button" class="btn btn-sm"
                (click)="editMode.setFalse()">
          <span class="bi bi-x"></span>
        </button>
      }
    </div>
  </form>
} @else {
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <p class="mb-0">{{ content() }}</p>
      <span class="small text-muted">
            @if (characterName(); as cName) {
              <span>{{ cName }}</span>
            } @else {
              <span>All</span>
            }
        <span>&nbsp;-&nbsp;</span>
            <span>{{ createdAt() | timeAgo:true | async }}</span>
        @if (alwaysInclude()) {
          <span>&nbsp;-&nbsp;Always included</span>
        }
          </span>
    </div>
    <div class="btn-toolbar">
      @if (!disabled()) {
        <button type="button" class="btn btn-sm" (click)="editMode.setTrue()">
          <span class="bi bi-pencil"></span>
        </button>
      }
    </div>
  </div>
}
